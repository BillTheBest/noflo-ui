<link rel="import" href="noflo-main.html">
<link rel="import" href="../bower_components/the-graph/the-graph-editor/the-graph-editor.html">
<link rel="import" href="noflo-library.html">
<link rel="import" href="noflo-context.html">
<link rel="import" href="noflo-runtime.html">
<link rel="import" href="noflo-journal.html">
<link rel="import" href="noflo-component-editor.html">
<link rel="import" href="noflo-search.html">
<link rel="import" href="noflo-project.html">
<link rel="import" href="noflo-packets.html">
<polymer-element name="noflo-ui" attributes="width height">
  <template>
    <noflo-main id="main"></noflo-main>
    <the-graph-editor id="grapheditor" width="{{ width }}" height="{{ height }}"></the-graph-editor>
    <noflo-library></noflo-library>
    <noflo-context></noflo-context>
    <noflo-runtime></noflo-runtime>
    <noflo-journal></noflo-journal>
    <noflo-component-editor id="componenteditor" width="{{ width }}" height="{{ height }}"></noflo-component-editor>
    <noflo-search></noflo-search>
    <noflo-project></noflo-project>
    <noflo-packets></noflo-packets>
  </template>
  <script>
    Polymer('noflo-ui', {
      width: window.innerWidth,
      height: window.innerHeight,
      ready: function () {
        this.$.main.addEventListener('logout', function (event) {
          this.fire('user:logout', true);
        }.bind(this));
        this.$.main.addEventListener('login', function (event) {
          this.fire('user:login', true);
        }.bind(this));
        /*
        this.$.main.addEventListener('download', function (event) {
          this.fire('event', 
        }.bind(this));
        */
      },
      context: function (context) {
        console.log('CTX is', context);
        if (context.projects) {
          this.populateMain(context);
          this.$.main.open = true;
          return;
        }
        this.$.main.open = false;
        if (context.graphs.length) {
          this.$.grapheditor.graph = context.graphs[context.graphs.length - 1];
        }
        this.$.componenteditor.component = context.component;
      },
      populateMain: function (ctx) {
        ctx.projects.forEach(this.$.main.projects.bind(this.$.main));
        ctx.runtimes.forEach(this.$.main.runtimes.bind(this.$.main));
      },
      user: function (user) {
        this.$.main.githubToken = user['github-token'];
        this.$.main.gridToken = user['grid-token'];
        this.$.main.user = user['grid-user'];
        this.$.main.avatar = user['grid-avatar'];
        this.$.main.plan = user['flowhub-plan'];
      }
    });
  </script>
</polymer-element>
